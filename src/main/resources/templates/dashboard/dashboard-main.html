<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>NHN Academy IoT 센서 관리 - 메인 대시보드</title>
    <!-- SB Admin 기본 CSS -->
    <link href="/admin/css/styles.css" rel="stylesheet" />
    <!-- Font Awesome 아이콘 -->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Bootstrap 5 CSS (styles.css에 포함되어 있지 않다면 추가) -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" /> -->

    <style>
        /* 커스텀 스타일 */
        .dashboard-summary-card .card-body {
            padding: 1.5rem;
        }
        .dashboard-summary-card .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }
        .dashboard-summary-card .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .dashboard-summary-card .icon-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        .icon-circle.bg-primary-soft { background-color: rgba(13, 110, 253, 0.1); color: #0d6efd; }
        .icon-circle.bg-success-soft { background-color: rgba(25, 135, 84, 0.1); color: #198754; }
        .icon-circle.bg-info-soft { background-color: rgba(13, 202, 240, 0.1); color: #0dcaf0; }

        .gauge-card .card-header {
            font-weight: 500;
        }
        .gauge-card .card-body {
            padding: 1rem; /* 게이지 카드 내부 패딩 조정 */
            height: 220px; /* 게이지 카드 높이 고정 (내부 canvas 높이 고려) */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .gauge-card canvas {
            max-height: 120px; /* 게이지 차트 최대 높이 */
            width: 100% !important;
        }
        .gauge-card .gauge-value-text {
            font-size: 1.5rem; /* 게이지 값 텍스트 크기 */
            font-weight: bold;
            margin-top: 0.5rem;
        }

        .alert-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #eee;
        }
        .alert-list-item:last-child {
            border-bottom: none;
        }
        .alert-list-item .alert-icon {
            margin-right: 0.75rem;
        }
        .alert-list-item .alert-text {
            flex-grow: 1;
            font-size: 0.9rem;
        }
        .alert-list-item .alert-time {
            font-size: 0.8rem;
            color: #6c757d;
        }
        .card-header-link {
            font-size: 0.8rem;
            color: #0d6efd;
        }
    </style>
</head>

<body class="sb-nav-fixed">
<div th:replace="~{fragments/head :: header}"></div>
<div id="layoutSidenav">
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>
    <div id="layoutSidenav_content">
        <main>
            <div class="container-fluid px-4">
                <h1 class="mt-4">메인 대시보드</h1>
                <ol class="breadcrumb mb-4">
                    <li class="breadcrumb-item active">종합 현황</li>
                </ol>

                <div class="row mb-4">
                    <!-- 전체 자원 요약 -->
                    <div class="col-xl-4 col-md-6">
                        <div class="card dashboard-summary-card h-100 mb-4">
                            <div class="card-body d-flex align-items-center">
                                <div class="icon-circle bg-primary-soft me-3">
                                    <i class="fas fa-server"></i>
                                </div>
                                <div>
                                    <div class="stat-value" id="totalServersCount">JAVAME-SERVER</div>
                                    <div class="stat-label">등록된 서버</div>
                                </div>
                            </div>
                            <div class="card-footer py-1 px-3">
                                <div class="d-flex justify-content-between small">
                                    <span><i class="fas fa-cogs me-1"></i>서비스: <span id="totalServicesCount">--</span>개</span>
                                    <span><i class="fas fa-broadcast-tower me-1"></i>센서: <span id="totalSensorsCount">--</span>개</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Watch Alarm 카드 -->
                    <div class="col-xl-4 col-md-6">
                        <div class="card dashboard-summary-card h-100 mb-4"> <!-- ★ h-100 추가 -->
                            <div class="card-header bg-transparent border-0 pb-0 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Watch Alarm</h5>
                                <a href="#" class="card-header-link"><i class="fas fa-external-link-alt"></i></a>
                            </div>
                            <div class="card-body d-flex flex-column justify-content-center align-items-center pt-2 mt-3"> <!-- flex-column 및 justify-content-center 추가 -->
                                <div class="d-flex justify-content-around w-100"> <!-- 내부 요소들을 감싸는 div 추가 -->
                                    <div class="text-center">
                                        <div class="stat-value text-danger" id="alarm발생Count">0</div>
                                        <div class="stat-label">발생</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="stat-value text-success" id="alarm안정Count">0</div>
                                        <div class="stat-label">안정</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="stat-value text-warning" id="alarm데이터부족Count">0</div>
                                        <div class="stat-label">데이터부족</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Server Outbound Traffic 카드 -->
                    <div class="col-xl-4 col-md-6">
                        <div class="card dashboard-summary-card h-100 mb-4"> <!-- ★ h-100 추가 -->
                            <div class="card-header bg-transparent border-0 pb-0 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Server Outbound Traffic</h5>
                                <a href="#" class="card-header-link"><i class="fas fa-external-link-alt"></i></a>
                            </div>
                            <div class="card-body d-flex align-items-center">
                                <div class="icon-circle bg-info-soft me-3">
                                    <i class="fas fa-network-wired"></i>
                                </div>
                                <div>
                                    <div class="stat-value" id="outboundTrafficValue">0.0 MB</div>
                                    <div class="stat-label">현재 아웃바운드 트래픽</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 게이지 차트 행 -->
                <div class="row">
                    <!-- CPU 사용률 게이지 -->
                    <div class="col-xl-3 col-lg-6">
                        <div class="card gauge-card mb-4">
                            <div class="card-header">CPU 사용률</div>
                            <div class="card-body">
                                <canvas id="gauge1"></canvas>
<!--                                <div id="gauge1-value" class="gauge-value-text">&#45;&#45;%</div>-->
                            </div>
                        </div>
                    </div>
                    <!-- 메모리 사용량 게이지 -->
                    <div class="col-xl-3 col-lg-6">
                        <div class="card gauge-card mb-4">
                            <div class="card-header">메모리 사용량</div>
                            <div class="card-body">
                                <canvas id="gauge2"></canvas>
<!--                                <div id="gauge2-value" class="gauge-value-text">&#45;&#45;%</div>-->
                            </div>
                        </div>
                    </div>
                    <!-- 디스크 사용률 게이지 -->
                    <div class="col-xl-3 col-lg-6">
                        <div class="card gauge-card mb-4">
                            <div class="card-header">디스크 사용률</div>
                            <div class="card-body">
                                <canvas id="gauge3"></canvas>
<!--                                <div id="gauge3-value" class="gauge-value-text">&#45;&#45;%</div>-->
                            </div>
                        </div>
                    </div>
                    <!-- 네트워크 트래픽 또는 서버룸 온도 게이지 -->
                    <div class="col-xl-3 col-lg-6">
                        <div class="card gauge-card mb-4">
                            <div class="card-header">서버 온도</div>
                            <div class="card-body">
                                <canvas id="gauge4"></canvas>
<!--                                <div id="gauge4-value" class="gauge-value-text">&#45;&#45;°C</div>-->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 최근 알림 목록 카드 (이미지와 유사하게) -->
                <div class="row">
                    <div class="col-12">
                        <div class="card mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-bell me-1"></i> 최근 알림</span>
                                <a href="#" class="card-header-link">더보기 <i class="fas fa-arrow-right"></i></a>
                            </div>
                            <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                                <!-- 알림 목록은 JS로 동적 생성 또는 서버에서 받아옴 -->
                                <div class="alert-list-item">
                                    <span class="alert-icon text-warning"><i class="fas fa-exclamation-triangle"></i></span>
                                    <span class="alert-text">Seoul M2 zone 관리 서버 재기동 작업</span>
                                    <span class="alert-time">04/29 09:19</span>
                                </div>
                                <div class="alert-list-item">
                                    <span class="alert-icon text-success"><i class="fas fa-check-circle"></i></span>
                                    <span class="alert-text">Server 생성 성공</span>
                                    <span class="alert-time">04/29 08:20</span>
                                </div>
                                <div class="alert-list-item">
                                    <span class="alert-icon text-danger"><i class="fas fa-times-circle"></i></span>
                                    <span class="alert-text">web1 Server 생성 실패</span>
                                    <span class="alert-time">04/29 08:20</span>
                                </div>
                                <!-- 추가 알림들... -->
                            </div>
                        </div>
                    </div>
                </div>

            </div> <!-- /.container-fluid -->
        </main>
        <div th:replace="~{fragments/footer :: footer}"></div>
    </div> <!-- /#layoutSidenav_content -->
</div> <!-- /#layoutSidenav -->

<!-- JavaScript 파일들 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="/admin/js/scripts.js"></script> <!-- SB Admin 기본 스크립트 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module" src="/admin/js/iotSensorApi.js"></script>
<script type="module" src="/admin/js/chartUtils.js"></script>
<script type="module" src="/admin/js/dashboardMain.js"></script> <!-- 이 HTML에 맞는 메인 대시보드 로직 파일 -->
</body>
</html>
